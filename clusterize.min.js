/*! Clusterize.js - v0.4.0 - 2015-05-02
* http://NeXTs.github.com/Clusterize.js/
* Copyright (c) 2015 Denis Lukov; Licensed MIT */

;(function(g,f){"undefined"!=typeof module?module.exports=f():"function"==typeof define&&"object"==typeof define.amd?define(f):this[g]=f();Array.prototype.forEach="function"==Array.prototype.forEach?Array.prototype.forEach:function(a){for(var b=this.length,c=0;c<b;++c)a(this[c])};this.addEvent=function(a,b,c){return a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)};this.removeEvent=function(a,b,c){return a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,
c)}})("Clusterize",function(){var g=function(){for(var a=3,b=document.createElement("b"),c=b.all||[];b.innerHTML="\x3c!--[if gt IE "+ ++a+"]><i><![endif]--\x3e",c[0];);return 4<a?a:document.documentMode}(),f=function(a){if(!(this instanceof f))return new f(a);var b=this,c={item_height:0,block_height:0,rows_in_block:50,rows_in_cluster:0,cluster_height:0,blocks_in_cluster:4,tag:null,content_tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,verify_change:!1};
b.options={};"rows_in_block blocks_in_cluster verify_change show_no_data_row no_data_class no_data_text keep_parity tag".split(" ").forEach(function(h){b.options[h]="undefined"!=typeof a[h]&&null!=a[h]?a[h]:c[h]});["scroll","content"].forEach(function(c){b[c+"Elem"]=a[c+"Id"]?document.getElementById(a[c+"Id"]):a[c+"Elem"];if(!b[c+"Elem"])throw Error("Error! Could not find "+c+" element");});var d=a.rows||[],e={data:""},g=b.scrollElem.scrollTop;b.exploreEnvironment(d);b.insertToDOM(d,e);b.scrollElem.scrollTop=
g;var l=!1,k=function(){l!=(l=b.getClusterNum())&&b.insertToDOM(d,e)};addEvent(b.scrollElem,"scroll",k);b.destroy=function(a){removeEvent(b.scrollElem,"scroll",k);b.html(a?b.generateEmptyRow().join(""):d.join(""))};b.update=function(a){d=b.isArray(a)?a:[];a=b.scrollElem.scrollTop;b.insertToDOM(d,e);b.scrollElem.scrollTop=a};b.append=function(a){a=b.isArray(a)?a:[];a.length&&(d=d.concat(a),b.insertToDOM(d,e))};b.clear=function(){b.update([])};b.getRowsAmount=function(){return d.length}};f.prototype=
{constructor:f,exploreEnvironment:function(a){var b=this.options;b.content_tag=this.contentElem.tagName.toLowerCase();if(!b.item_height||!b.tag){if(!a.length)return;this.html(a[0]+a[0]+a[0]);a=this.contentElem.children[1];b.tag||(b.tag=a.tagName.toLowerCase());b.item_height=a.offsetHeight}b.block_height=b.item_height*b.rows_in_block;b.rows_in_cluster=b.blocks_in_cluster*b.rows_in_block;b.cluster_height=b.blocks_in_cluster*b.block_height},getClusterNum:function(){var a=this.options;return Math.floor(this.scrollElem.scrollTop/
(a.cluster_height-a.block_height))},generateEmptyRow:function(){var a=this.options;if(!a.tag||!a.show_no_data_row)return[];var b=document.createElement(a.tag),c=document.createTextNode(a.no_data_text);b.className=a.no_data_class;if("tr"==a.tag){var d=document.createElement("td");d.appendChild(c)}b.appendChild(d||c);return[b.outerHTML]},generate:function(a,b){var c=this.options,d=a.length;if(!d)return this.generateEmptyRow();if(d<c.rows_in_block)return a;c.cluster_height||this.exploreEnvironment(a);
var e=b*c.rows_in_cluster-c.rows_in_block*b,e=0<e?e:0,f=e+c.rows_in_cluster,g=e*c.item_height,d=(d-f)*c.item_height,k=[],h=e;0<g?(c.keep_parity&&k.push(this.renderExtraTag("keep-parity")),k.push(this.renderExtraTag("top-space",g))):h++;for(c=e;c<f;c++)a[c]&&k.push(a[c]);0<d&&k.push(this.renderExtraTag("bottom-space",d));return{rows_above:h,rows:k}},renderExtraTag:function(a,b){var c=document.createElement(this.options.tag);c.className=["clusterize-extra-row","clusterize-"+a].join(" ");b&&(c.style.height=
b+"px");return c.outerHTML},insertToDOM:function(a,b){var c=this.generate(a,this.getClusterNum()),d=c.rows.join("");if(!this.options.verify_change||this.options.verify_change&&this.dataChanged(d,b))this.html(d),"ol"==this.options.content_tag&&this.contentElem.setAttribute("start",c.rows_above)},html:function(a){var b=this.contentElem;if(g&&9>=g&&"tr"==this.options.tag){var c=document.createElement("div");for(c.innerHTML="<table><tbody>"+a+"</tbody></table>";a=b.lastChild;)b.removeChild(a);a=0;for(var d=
c.firstChild.firstChild.childNodes.length,e=[];a<d;++a)e[a]=c.firstChild.firstChild.childNodes[a];for(c=Array.prototype.slice.call(e);c.length;)b.appendChild(c.shift())}else b.innerHTML=a},dataChanged:function(a,b){var c=JSON.stringify(a);return c!==b.data&&(b.data=c)},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)}};return f});
